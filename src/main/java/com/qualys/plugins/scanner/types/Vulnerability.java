package com.qualys.plugins.scanner.types;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

/**
 * Represents a single vulnerability finding from the scan.
 */
public class Vulnerability implements Serializable {
    private static final long serialVersionUID = 1L;

    private String qid;
    private String title;
    private String severity;
    private int severityLevel; // 5=Critical, 4=High, 3=Medium, 2=Low, 1=Info
    private double qdsScore;
    private List<String> cves;
    private String packageName;
    private String installedVersion;
    private String fixedVersion;
    private String description;
    private String solution;
    private String layerSHA;

    public Vulnerability() {
        this.cves = new ArrayList<>();
    }

    public String getQid() { return qid; }
    public void setQid(String qid) { this.qid = qid; }

    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }

    public String getSeverity() { return severity; }
    public void setSeverity(String severity) { this.severity = severity; }

    public int getSeverityLevel() { return severityLevel; }
    public void setSeverityLevel(int severityLevel) { this.severityLevel = severityLevel; }

    public double getQdsScore() { return qdsScore; }
    public void setQdsScore(double qdsScore) { this.qdsScore = qdsScore; }

    public List<String> getCves() { return cves; }
    public void setCves(List<String> cves) { this.cves = cves; }

    public String getCvesAsString() {
        return cves != null && !cves.isEmpty() ? String.join(", ", cves) : "-";
    }

    public String getPackageName() { return packageName; }
    public void setPackageName(String packageName) { this.packageName = packageName; }

    public String getInstalledVersion() { return installedVersion; }
    public void setInstalledVersion(String installedVersion) { this.installedVersion = installedVersion; }

    public String getFixedVersion() { return fixedVersion; }
    public void setFixedVersion(String fixedVersion) { this.fixedVersion = fixedVersion; }

    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }

    public String getSolution() { return solution; }
    public void setSolution(String solution) { this.solution = solution; }

    public String getLayerSHA() { return layerSHA; }
    public void setLayerSHA(String layerSHA) { this.layerSHA = layerSHA; }

    public String getLayerShort() {
        if (layerSHA == null || layerSHA.isEmpty()) return null;
        String sha = layerSHA;
        if (sha.startsWith("sha256:")) {
            sha = sha.substring(7);
        }
        return sha.length() > 12 ? sha.substring(0, 12) : sha;
    }

    public String getSeverityClass() {
        switch (severityLevel) {
            case 5: return "critical";
            case 4: return "high";
            case 3: return "medium";
            case 2: return "low";
            default: return "info";
        }
    }
}
